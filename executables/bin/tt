#!/usr/bin/env bash

if ! tmux list-sessions &>/dev/null; then
    echo "No tmux sessions found"
    exit 1
fi

session=$(tmux list-sessions -F "#{session_name}" 2>/dev/null | fzf \
    --prompt="tmux sessions (a=attach, k=kill): " \
    --bind="a:accept" \
    --bind="k:execute(tmux kill-session -t {})+reload(tmux list-sessions -F '#{session_name}' 2>/dev/null)" \
    --header="Press 'a' to attach, 'k' to kill session")

if [[ -n "$session" ]]; then
    if [ -n "$TMUX" ]; then
        # We're inside tmux, switch session
        tmux switch-client -t "$session"
    else
        # We're not in tmux, attach normally
        tmux attach-session -t "$session"
    fi
fi