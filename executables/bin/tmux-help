#!/usr/bin/env bash

# Check for layout parameter (1 = single column, 2 = bordered layout, default = auto)
LAYOUT="${1:-auto}"

# Auto-detect layout based on terminal width if no parameter given
if [ "$LAYOUT" = "auto" ]; then
    # Try multiple methods to get terminal width
    if [ -n "$TMUX" ]; then
        # Inside tmux, get the actual pane width
        TERMINAL_WIDTH=$(tmux display-message -p "#{pane_width}" 2>/dev/null || echo 80)
    else
        # Outside tmux, use standard methods
        TERMINAL_WIDTH=$(tput cols 2>/dev/null || stty size 2>/dev/null | cut -d' ' -f2 || echo 80)
    fi
    
    if [ "$TERMINAL_WIDTH" -ge 86 ]; then
        LAYOUT="2"  # Use bordered layout
    else
        LAYOUT="1"  # Use single column layout
    fi
fi

if [ "$LAYOUT" = "1" ]; then
    # Single column layout
    echo "TMUX COMMANDS"
    echo ""
    echo "Essential Commands:"
    echo "  - Ctrl+b d  - Detach from session"
    echo "  - tt        - Session manager (fzf)"
    echo ""
    echo "More Help:"
    echo "  - Ctrl+b ?  - Show all key bindings"
    echo "  - Ctrl+b [  - Copy mode (scroll)"
    echo ""
    echo "Pane Management:"
    echo "  - Ctrl+b %    - Split vertically"
    echo "  - Ctrl+b \"    - Split horizontally"
    echo "  - Ctrl+b ←↑↓→ - Navigate panes"
    echo "  - Ctrl+b o    - Switch to next pane"
    echo "  - Ctrl+b x    - Kill current pane"
    echo "  - Ctrl+b z    - Toggle pane zoom"
    echo ""
    echo "Pane Resizing:"
    echo "  - Ctrl+b Ctrl+←↑↓→ - Resize pane"
    echo "  - Ctrl+b Alt+←↑↓→  - Resize by 5 steps"
    echo ""
    echo "Layout Controls:"
    echo "  - Ctrl+b Space - Cycle through layouts"
    echo ""
elif [ "$LAYOUT" = "2" ]; then
    # Bordered layout (original)
    echo "┌───────────────────────────────────────────────────────────────────────────────────┐"
    echo "│                                   TMUX COMMANDS                                   │"
    echo "├───────────────────────────────────────────────────────────────────────────────────┤"
    echo "│ Essential Commands:                 │ Pane Management:                            │"
    echo "│   Ctrl+b d  - Detach from session   │   Ctrl+b %    - Split vertically            │"
    echo "│   tt        - Session manager (fzf) │   Ctrl+b \"    - Split horizontally          │"
    echo "│                                     │   Ctrl+b ←↑↓→ - Navigate panes              │"
    echo "│ More Help:                          │   Ctrl+b o    - Switch to next pane         │"
    echo "│   Ctrl+b ?  - Show all key bindings │   Ctrl+b x    - Kill current pane           │"
    echo "│   Ctrl+b [  - Copy mode (scroll)    │   Ctrl+b z    - Toggle pane zoom            │"
    echo "│                                     │                                             │"
    echo "│                                     │ Pane Resizing:                              │"
    echo "│                                     │   Ctrl+b Ctrl+←↑↓→ - Resize pane            │"
    echo "│                                     │   Ctrl+b Alt+←↑↓→  - Resize by 5 steps      │"
    echo "│                                     │                                             │"
    echo "│                                     │ Layout Controls:                            │"
    echo "│                                     │   Ctrl+b Space - Cycle through layouts      │"
    echo "└───────────────────────────────────────────────────────────────────────────────────┘"
    echo ""
else
    echo "Usage: tmux-help [1|2]"
    echo "  1 - Single column layout"
    echo "  2 - Bordered layout"
    echo "  (no param) - Auto-detect based on terminal width"
    exit 1
fi
